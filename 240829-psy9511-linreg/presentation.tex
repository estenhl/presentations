\documentclass[10pt]{beamer}

\usetheme{metropolis}

\usepackage[export]{adjustbox}
\usepackage{array}
\usepackage{etoolbox}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{listings}
\usepackage{pgfplots}
\usepackage{tikz}
\usepackage{xcolor}

\usepgfplotslibrary{fillbetween}

\usetikzlibrary{calc}
\usetikzlibrary{patterns}

\hypersetup{
    colorlinks=true,
    linkcolor=white,
    urlcolor=blue!80
}

\definecolor{uiored}{HTML}{DD0000}
\definecolor{uiolightred}{HTML}{FB6666}
\definecolor{uioredtone}{HTML}{FEE0E0}
\definecolor{uioblue}{HTML}{3E31D6}
\definecolor{uiolightblue}{HTML}{86A4F7}
\definecolor{uioblueone}{HTML}{E6ECFF}
\definecolor{uiogreen}{HTML}{2EC483}
\definecolor{uiolightgreen}{HTML}{6CE1AB}
\definecolor{uiogreentone}{HTML}{CEFFDF}
\definecolor{uioorange}{HTML}{FEA11B}
\definecolor{uiolightorange}{HTML}{FDCB87}
\definecolor{uioorangetone}{HTML}{FFE8D4}
\definecolor{uioyellow}{HTML}{FFFEA7}
\definecolor{uiogray}{HTML}{B2B3B7}

\colorlet{mainbackground}{uiored}

\setbeamercolor{frametitle}{bg=mainbackground, fg=white}
\setbeamercolor{title separator}{fg=mainbackground}
\setbeamercolor{progress bar in section page}{fg=white, bg=uiogray}

\def\logowidth{4cm}

\makeatletter
\setbeamertemplate{section page}
{
  \begingroup

    \vspace{4.3cm}
    {\usebeamercolor[fg]{section title}\usebeamerfont{section title}\insertsectionhead}\\[-1ex]
    {\centering\color{white}\rule{\linewidth}{1pt}\par} % the horizontal line

    \vspace*{3.1cm}
    \begin{center}
        \includegraphics[width=\logowidth,valign=c]{data/uio_logo_full_white.png} % Adjust width and path to your logo as needed
    \end{center}

  \endgroup
}
\makeatother

\AtBeginSection{
  {
    \setbeamercolor{background canvas}{bg=uiored}
    \setbeamercolor{section title}{fg=white}
    \frame[plain,c,noframenumbering]{\sectionpage}
    \setbeamercolor{background canvas}{bg=black!2}
  }
}



\setbeamertemplate{footline}{
    \ifnum\insertframenumber=1
        % Title page, no footer
    \else
        \begin{tikzpicture}[remember picture,overlay]
            \fill[mainbackground] (current page.south west) rectangle ([yshift=0.45cm]current page.south east); % Draw filled rectangle

            % Logo
            \node[anchor=west, yshift=0.225cm] at (current page.south west) {\includegraphics[height=1.2cm]{data/uio_logo_white.png}};

            % Title and subtitle
            \node[align=center, yshift=0.225cm] at (current page.south) {\textcolor{white}{\textbf{\inserttitle}}\\[0.05cm]\textcolor{white}{\insertsubtitle}};

            % Page number
            \node[anchor=east, yshift=0.225cm, xshift=-0.2cm, align=right] at (current page.south east) {\textcolor{white}{\insertframenumber/\inserttotalframenumber}};
        \end{tikzpicture}
    \fi
}

\lstdefinestyle{Core}{
    identifierstyle=\color[RGB]{0, 0, 0},
    stringstyle=\color[RGB]{205, 49, 49},
    showstringspaces=false,
    breaklines,
    xleftmargin=3pt,
    xrightmargin=3pt,
    framesep=3pt,
    aboveskip=-1.5pt,
    belowskip=-0.5pt,
    showlines=true,
}

\lstdefinestyle{RInput}{
    style=Core,
    language=R,
    keywordstyle=\color[RGB]{17, 115, 187},
    commentstyle=\color[RGB]{0, 128, 0},
    identifierstyle=\color[RGB]{0, 0, 0},
    stringstyle=\color[RGB]{205, 49, 49},
    backgroundcolor=\color[RGB]{255, 255, 255},
    frame=single,
    rulecolor=\color[RGB]{0, 0, 0},
}

\lstdefinestyle{PythonInput}{
    style=Core,
    language=Python,
    keywordstyle=\color[RGB]{26, 13, 171},
    commentstyle=\color[RGB]{0, 128, 0},
    backgroundcolor=\color[RGB]{245, 245, 245},
    rulecolor=\color[RGB]{192, 192, 192},
    frame=tblr,
}

\lstdefinestyle{ROutput}{
    style=Core,
    language=R,
    backgroundcolor=\color[RGB]{255, 255, 255},
    commentstyle=\color[HTML]{009900},
    stringstyle=\color[HTML]{0000FF},
    keywordstyle=\color[HTML]{000000},
    numberstyle=\tiny\color[HTML]{000000},
    breakatwhitespace=true,
    frame=single,
    rulecolor=\color{black},
}

\lstdefinestyle{PythonOutput}{
    backgroundcolor=\color[RGB]{255, 255, 255},
    rulecolor=\color[RGB]{192, 192, 192},
    frame=single,
    numbers=none,
    showstringspaces=false,
    breakatwhitespace=true,
    keywordstyle=\color[RGB]{255, 0, 0},
    morekeywords={AttributeError}
}

\newcommand{\PythonInputNode}[6]{%
    \node[
        minimum width=#4,
        text width=#4,
        align=left,
        inner sep=0pt,
        outer sep=0pt,
        anchor=north west,
        label={[blue,
                anchor=north east,
                font=\ttfamily\fontsize{\the\numexpr#5-1\relax}{#5}\selectfont,
                inner sep=0pt,
                outer sep=0pt,
                xshift=-3pt,
                yshift=-3pt
                ]north west:In{[}#1{]}:},
    ] (#3) at #2 {
    \begin{lstlisting}[
        style=PythonInput,
        linewidth=#4,
        basicstyle=\ttfamily\fontsize{\the\numexpr#5-1\relax}{#5}\selectfont,
        numberstyle=\fontsize{\the\numexpr#5-1\relax}{#5}\selectfont\color[RGB]{128, 128, 128},
    ]^^J
        #6
    \end{lstlisting}
    };
}

\newcommand{\RInputNode}[5]{
    \node[
        minimum width=#3,
        text width=#3,
        align=left,
        inner sep=0pt,
        outer sep=0pt,
        draw=black,
        anchor=north west
    ] (#2) at #1 {
        \begin{lstlisting}[
            style=RInput,
            linewidth=\textwidth,
            basicstyle=\ttfamily\fontsize{\the\numexpr#4-1\relax}{#4}\selectfont,
            numberstyle=\fontsize{\the\numexpr#4-1\relax}{#4}\selectfont\color[RGB]{128, 128, 128},
        ]^^J
            #5
        \end{lstlisting}
    };
}

\title{PSY9511: Seminar 4}
\subtitle{The basics of regression and classification}
\author{Esten H. Leonardsen}
\date{29.05.2024}

\titlegraphic{
	\centering
	\vspace{7.7cm}
	\includegraphics[width=\logowidth]{data/uio_logo_full.png}
}

\begin{document}
	\begin{frame}
	 	\titlepage
	\end{frame}

    \begin{frame}[t]{Recap}
        \only<1-4>{
            \vspace{0.5cm}
            \underline{What is statistical learning?}\\
            \vspace{0.5cm}


            \only<2>{\small{\textbf{Inferentiental view:} Finding a function $\hat{f}(X)$ that describes the relationship between some input variables $X$ and an output variable $y$.}\\}
            \only<3>{\textcolor{gray!20}{\small{\textbf{Inferentiental view:} Finding a function $\hat{f}(X)$ that describes the relationship between some input variables $X$ and an output variable $y$.}\\}}
            \only<4>{\small{\textcolor{gray!20}{\textbf{Inferentiental view:}} Finding a function $\hat{f}(X)$ \textcolor{gray!20}{that describes the relationship between some input variables $X$ and an output variable $y$.}\\}}
            \vspace{0.25cm}
            \vspace{0.25cm}
            \only<3>{\small{\textbf{Predictive view:} Finding a function $\hat{f}(X)$ that, when given a new set of inputs $X$ allows us to predict an output $y$.}}
            \only<4>{\small{\textcolor{gray!20}{\textbf{Predictive view:}} Finding a function $\hat{f}(X)$ \textcolor{gray!20}{ that, when given a new set of inputs $X$ allows us to predict an output $y$.}}}
        }

        \onslide<5->{
            \centering
            \begin{tikzpicture}
                \begin{axis}[
                    xtick pos=bottom,
                    ytick pos=left,
                    xmin=30,
                    xmax=240,
                    ymin=3,
                    ymax=50,
                    xlabel=Horsepower (x),
                    ylabel=Miles per gallon (y),
                    height=6.8cm,
                    width=11cm
                ]
                    \addplot[
                        only marks,
                        opacity=0.6
                    ] table [
                        col sep=comma,
                        x=horsepower,
                        y=mpg
                    ] {data/Auto.csv};
                    \only<7>{
                        \addplot[
                            domain=30:240,
                            samples=100,
                            color=red,
                            thick
                        ] {39.93 - 0.1578*x};
                    }
                    \only<8>{
                        \addplot[
                            domain=30:240,
                            samples=100,
                            color=red,
                            thick
                        ] {23.44};
                    }
                    \only<9>{
                        \addplot[
                            domain=30:240,
                            samples=100,
                            color=red,
                            thick
                        ] {exp(3.86-0.0073*x)};
                    }
                \end{axis}
            \end{tikzpicture}\\
            \vspace{0.2cm}
            \hspace{1.3cm}
            \only<6>{
                \textcolor{red}{$\hat{y}=\hat{f}(x)$}
            }
            \only<7>{
                \textcolor{red}{$\hat{y}=39.93-0.1578x$}
            }
            \only<8>{
                \textcolor{red}{$\hat{y}=23.44$}
            }
            \only<9>{
                \textcolor{red}{$\hat{y}=e^{3.86-0.0073x}$}
            }
        }
    \end{frame}

    \begin{frame}[t]{Outline}
        \underline{Plan for the day:}
        \begin{itemize}
            \item<2-> Different types of outputs $y$: Regression vs classification
            \item<3-> Simple solutions to regression problems
            \begin{itemize}
                \item<4-> Linear regression
                \item<4-> k nearest neighbours
            \end{itemize}
            \item<4-> Finding $\hat{f}(X)$: Training machine learning models
            \item<5-> Simple solutions to classification problems
            \begin{itemize}
                \item<6-> Logistic regression
                \item<6-> Generative models
            \end{itemize}
        \end{itemize}
        \only<7>{
            \underline{Plan for future lectures:}
            \begin{itemize}
                \item How do we evaluate how good our models are? (Lecture 3)
                \item Complex solutions to regression and classification problems (Lecture 4 and onwards)
            \end{itemize}
        }
    \end{frame}

    \begin{frame}{Regression vs classification}

    \end{frame}

    \begin{frame}[t]{Linear regression (via ordinary least squares)}
        \begin{tikzpicture}
            \begin{axis}[
                xtick pos=bottom,
                ytick pos=left,
                xmin=30,
                xmax=240,
                ymin=3,
                ymax=50,
                xlabel=Horsepower (x),
                ylabel=Miles per gallon (y),
                height=6.8cm,
                width=10.7cm
            ]
                \only<2-5>{
                    \addplot[
                        only marks,
                        opacity=0.6
                    ] table [
                        col sep=comma,
                        x=horsepower,
                        y=mpg
                    ] {data/Auto.csv};
                }
                \only<6-14>{
                    \addplot[
                        only marks,
                        opacity=0.05
                    ] table [
                        col sep=comma,
                        x=horsepower,
                        y=mpg
                    ] {data/Auto.csv};
                    \addplot[
                        only marks,
                        opacity=0.8
                    ] coordinates {
                        (115, 28.9)
                    };
                }
                \only<7-10>{
                    \draw[dashed] (axis cs: 115, 3) -- (axis cs: 115, 50);
                    \node[anchor=south, draw=black, fill=white, inner sep=2pt] at (axis cs: 115, 5) {\small{115}};
                }
                \only<3-14>{
                    \addplot[
                        domain=30:240,
                        samples=100,
                        color=red,
                        thick
                    ] {39.93 - 0.1578*x};
                }
                \only<10-14>{
                    \addplot[
                        only marks,
                        red,
                        opacity=0.6
                    ] coordinates {
                        (115, 21.78)
                    };
                }
                \only<11-13>{
                    \node[anchor=north] at (axis cs: 115, 21.78) {\small{$\hat{y}$}};
                    \node[anchor=south] at (axis cs: 115, 28.9) {\small{$y$}};
                }
                \only<12>{
                    \draw[] (axis cs: 115, 21.78) -- (axis cs: 115, 28.9);
                    \node[anchor=west] at (axis cs: 115, 25.34) {\small{$|y-\hat{y}|$}};
                }
                \only<13>{
                    \draw[] (axis cs: 115, 21.78) --
                                                 (axis cs: 115, 28.9) --
                                                 (axis cs: 134, 28.9) --
                                                 (axis cs: 134, 21.78) -- cycle;
                    \node[anchor=west] at (axis cs: 134, 25.34) {\small{$(y-\hat{y})^2$}};
                }
                \only<14>{
                    \draw[] (axis cs: 115, 21.78) --
                                                 (axis cs: 115, 28.9) --
                                                 (axis cs: 134, 28.9) --
                                                 (axis cs: 134, 21.78) -- cycle;
                    \draw[] (axis cs: 60, 27) --
                                                 (axis cs: 60, 30.462) --
                                                 (axis cs: 69, 30.462) --
                                                 (axis cs: 69, 27) -- cycle;
                    \draw[] (axis cs: 75, 26) --
                                                 (axis cs: 75, 28.095) --
                                                 (axis cs: 81, 28.095) --
                                                 (axis cs: 81, 26) -- cycle;
                    \draw[] (axis cs: 165.3, 17.7) --
                                                (axis cs: 165.3, 13.85) --
                                                (axis cs: 176, 13.85) --
                                                (axis cs: 176, 17.7) -- cycle;
                    \draw[] (axis cs: 198, 15) --
                                                (axis cs: 198, 8.68) --
                                                (axis cs: 215, 8.68) --
                                                (axis cs: 215, 15) -- cycle;

                    \addplot[
                        only marks,
                        opacity=0.8
                    ] coordinates {
                        (60, 27)
                        (75, 26)
                        (165.3, 17.7)
                        (198, 15)
                    };
                    \addplot[
                        only marks,
                        red,
                        opacity=0.6
                    ] coordinates {
                        (60, 30.462)
                        (75, 28.095)
                        (165.3, 13.85)
                        (198, 8.68)
                    };
                }
                \only<4>{
                    \addplot[
                        domain=30:240,
                        samples=100,
                        color=blue,
                        thick
                    ] {36 - 0.1*x};
                }

            \end{axis}
        \end{tikzpicture}\\
        \centering
        \only<3-7>{
            \hspace{0.8cm}\textcolor{red}{$\hat{y}=39.93-0.1578x$}\\
        }
        \only<4>{
            \hspace{0.8cm}\textcolor{blue}{$\hat{y}=36-0.1x$}
        }
        \only<8>{
            \hspace{0.8cm}\textcolor{red}{$\hat{y}=39.93-0.1578*115$}\\
        }
        \only<9-10>{
            \hspace{0.8cm}\textcolor{red}{$21.78=39.93-0.1578*115$}\\
        }
    \end{frame}


\end{document}
