\section{How can we find new phenotypes with AI?}

\begin{frame}{What does neural networks do?}
    \begin{tikzpicture}
        \node[draw=black] at (-5.25, -3.25) {};
        \node[draw=black] at (5.25, 3.25) {};

        \visible<3>{
            \inputside{-3.95}{0}{1.5cm}{0.75}
            \cnnarrow{(input.east)}{($ (input.center) + (2, 0) $)}{blue}
        }
        \visible<3-5>{
            \node[draw=black, minimum height=2.8cm, minimum width=0.1cm, top color=red, bottom color=white, inner sep=0pt] (scale) at (3.5, 0) {};
            \cnnarrow{(2.41, 0)}{(scale.west)}{blue}
            \node[anchor=west, font=\footnotesize] at (scale.north east) {
                1
            };
            \node[anchor=west, font=\footnotesize] at (scale.south east) {
                0
            };
        }
        \visible<4-5>{
            \inputside{-3.3}{1.25}{0.75cm}{0.375}
            \inputside{-3.3}{-1.25}{0.75cm}{0.375}
            \inputside{-4.55}{0}{0.75cm}{0.375}
            \inputside{-4.55}{1.25}{0.75cm}{0.375}
            \inputside{-4.55}{-1.25}{0.75cm}{0.375}
            \inputside{-3.3}{0}{0.75cm}{0.375}
            \cnnarrow{(input.east)}{($ (input.center) + (2, 0) $)}{blue}
        }
        \visible<3>{
            \node[circle, minimum size=0.18cm, inner sep=0pt, draw=black, fill=white, label=right:\textbf{\footnotesize{0.40}}] at ($ (scale) - (0, 0.28) $) {};
        }
        \visible<4>{
            \node[circle, minimum size=0.18cm, inner sep=0pt, draw=black, fill=white] at ($ (scale) - (0, 0.28) $) {};
            \node[circle, minimum size=0.18cm, inner sep=0pt, draw=black, fill=white] at ($ (scale) - (0, 1.2) $) {};
            \node[circle, minimum size=0.18cm, inner sep=0pt, draw=black, fill=white] at ($ (scale) - (0, 1.0) $) {};
            \node[circle, minimum size=0.18cm, inner sep=0pt, draw=black, fill=white] at ($ (scale) - (0, 0.9) $) {};
            \node[circle, minimum size=0.18cm, inner sep=0pt, draw=black, fill=white] at ($ (scale) - (0, 0.7) $) {};
            \node[circle, minimum size=0.18cm, inner sep=0pt, draw=black, fill=white] at ($ (scale) + (0, 0.14) $) {};
            \node[circle, minimum size=0.18cm, inner sep=0pt, draw=black, fill=white] at ($ (scale) + (0, 0.3) $) {};
            \node[circle, minimum size=0.18cm, inner sep=0pt, draw=black, fill=white] at ($ (scale) + (0, 0.7) $) {};
            \node[circle, minimum size=0.18cm, inner sep=0pt, draw=black, fill=white] at ($ (scale) + (0, 0.95) $) {};
            \node[circle, minimum size=0.18cm, inner sep=0pt, draw=black, fill=white] at ($ (scale) + (0, 1.35) $) {};
        }
        \visible<5>{
            \node[circle, minimum size=0.18cm, inner sep=0pt, draw=black, fill=white] at ($ (scale) - (0, 1.2) $) {};
            \node[circle, minimum size=0.18cm, inner sep=0pt, draw=black, fill=red] at ($ (scale) - (0, 1.0) $) {};
            \node[circle, minimum size=0.18cm, inner sep=0pt, draw=black, fill=white] at ($ (scale) - (0, 0.9) $) {};
            \node[circle, minimum size=0.18cm, inner sep=0pt, draw=black, fill=white] at ($ (scale) - (0, 0.7) $) {};
            \node[circle, minimum size=0.18cm, inner sep=0pt, draw=black, fill=red] at ($ (scale) - (0, 0.28) $) {};
            \node[circle, minimum size=0.18cm, inner sep=0pt, draw=black, fill=red] at ($ (scale) + (0, 0.14) $) {};
            \node[circle, minimum size=0.18cm, inner sep=0pt, draw=black, fill=white] at ($ (scale) + (0, 0.3) $) {};
            \node[circle, minimum size=0.18cm, inner sep=0pt, draw=black, fill=red] at ($ (scale) + (0, 0.7) $) {};
            \node[circle, minimum size=0.18cm, inner sep=0pt, draw=black, fill=red] at ($ (scale) + (0, 0.95) $) {};
            \node[circle, minimum size=0.18cm, inner sep=0pt, draw=black, fill=red] at ($ (scale) + (0, 1.35) $) {};


            \node[circle, minimum size=0.18cm, inner sep=0pt, draw=black, fill=red, label=right:\footnotesize{Cases}] at ($ (scale) - (0.6, 1.7) $) {};
            \node[circle, minimum size=0.18cm, inner sep=0pt, draw=black, fill=white, label=right:\footnotesize{Controls}] at ($ (scale) - (0.6, 1.95) $) {};
        }


        \visible<1>{
            \cnn{-2.55}{0}{0.066}{0.15}{blue}{Convolutional neural network}
        }
        \visible<2-5>{
            \cnn{-2.55}{0}{0.066}{0.15}{blue}{Trained case-control classifier}
        }

        \visible<6-8>{
            \def\spacing{-0.1cm}
            \node[align=left, font=\tiny] at (0, 0) {
                \begin{math}
                    \begin{alignedat}{5}
                        \hat{y} &= \max(0, &&0.45*\max(0, &&0.67*\max(0, 0.12*x_0+0.34*x_{1}+0.56*x_{2}+0.78*x_{3}+0.91)+\\[\spacing]
                        & && &&0.23*\max(0, 0.11*x_0+0.22*x_{1}+0.33*x_{2}+0.44*x_{3}+0.55)+\\[\spacing]
                        & && &&0.89*\max(0, 0.66*x_0+0.77*x_{1}+0.88*x_{2}+0.99*x_{3}+0.10)+\\[\spacing]
                        & && &&0.21)+\\[\spacing]
                        & &&0.54*\max(0, &&0.76*\max(0, 0.12*x_0+0.34*x_{1}+0.56*x_{2}+0.78*x_{3}+0.91)+\\[\spacing]
                        & && &&0.65*\max(0, 0.11*x_0+0.22*x_{1}+0.33*x_{2}+0.44*x_{3}+0.55)+\\[\spacing]
                        & && &&0.43*\max(0, 0.66*x_0+0.77*x_{1}+0.88*x_{2}+0.99*x_{3}+0.10)+\\[\spacing]
                        & && &&0.32)+\\[\spacing]
                        & &&0.98*\max(0, &&0.87*\max(0, 0.12*x_0+0.34*x_{1}+0.56*x_{2}+0.78*x_{3}+0.91)+\\[\spacing]
                        & && &&0.76*\max(0, 0.11*x_0+0.22*x_{1}+0.33*x_{2}+0.44*x_{3}+0.55)+\\[\spacing]
                        & && &&0.65*\max(0, 0.66*x_0+0.77*x_{1}+0.88*x_{2}+0.99*x_{3}+0.10)+\\[\spacing]
                        & && &&0.54)+\\[\spacing]
                        & &&0.31*\max(0, &&0.21*\max(0, 0.12*x_0+0.34*x_{1}+0.56*x_{2}+0.78*x_{3}+0.91)+\\[\spacing]
                        & && &&0.32*\max(0, 0.11*x_0+0.22*x_{1}+0.33*x_{2}+0.44*x_{3}+0.55)+\\[\spacing]
                        & && &&0.43*\max(0, 0.66*x_0+0.77*x_{1}+0.88*x_{2}+0.99*x_{3}+0.10)+\\[\spacing]
                        & && &&0.65)+\\[\spacing]
                        & &&0.06*\max(0, &&0.27*\max(0, 0.12*x_0+0.34*x_{1}+0.56*x_{2}+0.78*x_{3}+0.91)+\\[\spacing]
                        & && &&0.85*\max(0, 0.11*x_0+0.22*x_{1}+0.33*x_{2}+0.44*x_{3}+0.55)+\\[\spacing]
                        & && &&0.17*\max(0, 0.66*x_0+0.77*x_{1}+0.88*x_{2}+0.99*x_{3}+0.10)+\\[\spacing]
                        & && &&0.42)+\\[\spacing]
                        & &&0.76)&&\\
                    \end{alignedat}
                \end{math}

            };
        }
        \visible<7-8>{
            \node[minimum height=0.12cm, minimum width=6cm, draw=red, thick] at (1.04, -0.99) {};
        }
        \visible<8>{
            \node[minimum height=0.12cm, minimum width=0.4cm, draw=red, thick] at (-2.95, -0.49) {};
            \node[minimum height=0.12cm, minimum width=0.4cm, draw=red, thick] at (-2.95, -2.47) {};
        }
        \visible<9->{
            \inputside{-3.3}{2.25}{0.75cm}{0.375}
            \inputside{-3.3}{-0.25}{0.75cm}{0.375}
            \inputside{-4.55}{1}{0.75cm}{0.375}
            \inputside{-4.55}{2.25}{0.75cm}{0.375}
            \inputside{-4.55}{-0.25}{0.75cm}{0.375}
            \inputside{-3.3}{1}{0.75cm}{0.375}

            \def\xmin{-2.55}
            \def\ymin{1}
            \def\nodedepth{0.066}
            \def\nodesize{0.15}

            \draw[thick, dashed] (\xmin + 0.22, \ymin + 1.43) --
                                (\xmin + 5.13, \ymin + 1.43) --
                                (\xmin + 5.13, \ymin - 1.42) --
                                (\xmin + 0.22, \ymin - 1.42) -- cycle;
        }
        \visible<10->{
            \node[] (inputspace) at (-4, -2) {
                \usebox{\inputspace}
            };
            \node[circle, minimum size=0.1cm, inner sep=0pt, draw=black, fill=white, label=right:\footnotesize{Controls}] at ($ (inputspace.south east) + (-0.15, 0.3) $) {};
            \node[circle, minimum size=0.1cm, inner sep=0pt, draw=black, fill=red, label=right:\footnotesize{Cases}] at ($ (inputspace.south east) + (-0.15, 0.54) $) {};
        }
        \visible<11->{
            \node[anchor=north, draw=black, fill=black!60, inner sep=3pt] at ($ (inputspace.south) + (0, 0.07) $) {};
            \node[anchor=east, draw=black, fill=black!60, inner sep=3pt] at ($ (inputspace.west) + (0.25, 0) $) {};
        }
        \visible<9-11>{
            \convlayer{\xmin - 0.06 + 0.4}{\ymin + 2.5 * \nodesize}{\nodedepth}{\nodesize}{12}{3}{gray}
        }
        \visible<12->{
            \cnnarrow{(input.east)}{($ (input.center) + (2, 0) $)}{blue}
            \convlayer{\xmin - 0.06 + 0.4}{\ymin + 2.5 * \nodesize}{\nodedepth}{\nodesize}{12}{3}{blue}

            \node[] (firstfeatures) at (-0.95, -2) {
                \usebox{\firstfeaturespace}
            };
        }
        \visible<9-12>{
            \cnnarrow{(\xmin + 0.95, \ymin)}{(\xmin+2.2, \ymin)}{gray}
            \convlayer{\xmin + 1.44 + 0.4}{\ymin + 1.5 * \nodesize}{\nodedepth}{\nodesize}{8}{5}{gray}
        }
        \visible<13->{
            \cnnarrow{(\xmin + 0.95, \ymin)}{(\xmin+2.2, \ymin)}{blue}
            \convlayer{\xmin + 1.44 + 0.4}{\ymin + 1.5 * \nodesize}{\nodedepth}{\nodesize}{8}{5}{blue}

            \node[] (secondfeatures) at (0.38, -2) {
                \usebox{\secondfeaturespace}
            };
        }
        \visible<9-13>{
            \cnnarrow{(\xmin + 2.43, \ymin)}{(\xmin+3.5, \ymin)}{gray}
            \convlayer{\xmin + 2.77 + 0.4}{\ymin + 0.5 * \nodesize}{\nodedepth}{\nodesize}{4}{7}{gray}
        }
        \visible<14->{
            \cnnarrow{(\xmin + 2.43, \ymin)}{(\xmin+3.5, \ymin)}{blue}
            \convlayer{\xmin + 2.77 + 0.4}{\ymin + 0.5 * \nodesize}{\nodedepth}{\nodesize}{4}{7}{blue}

            \node[] (thirdfeatures) at (1.56, -2) {
                \usebox{\thirdfeaturespace}
            };
        }
        \visible<9-14>{
            \cnnarrow{(\xmin + 3.75, \ymin)}{(\xmin+5, \ymin)}{gray}
            \convlayer{\xmin + 3.93 + 0.4}{\ymin + 0}{\nodedepth}{\nodesize}{2}{9}{gray}
        }
        \visible<15->{
            \cnnarrow{(\xmin + 3.75, \ymin)}{(\xmin+5, \ymin)}{blue}
            \convlayer{\xmin + 3.93 + 0.4}{\ymin + 0}{\nodedepth}{\nodesize}{2}{9}{blue}

            \node[draw=black, minimum height=2.8cm, minimum width=0.1cm, top color=red, bottom color=white, inner sep=0pt] (scale) at (3.5, 1) {};
            \cnnarrow{(2.41, 1)}{(scale.west)}{blue}
            \node[anchor=west, font=\footnotesize] at (scale.north east) {
                1
            };
            \node[anchor=west, font=\footnotesize] at (scale.south east) {
                0
            };

            \node[circle, minimum size=0.18cm, inner sep=0pt, draw=black, fill=white] at ($ (scale) - (0, 1.2) $) {};
            \node[circle, minimum size=0.18cm, inner sep=0pt, draw=black, fill=red] at ($ (scale) - (0, 1.0) $) {};
            \node[circle, minimum size=0.18cm, inner sep=0pt, draw=black, fill=white] at ($ (scale) - (0, 0.9) $) {};
            \node[circle, minimum size=0.18cm, inner sep=0pt, draw=black, fill=white] at ($ (scale) - (0, 0.7) $) {};
            \node[circle, minimum size=0.18cm, inner sep=0pt, draw=black, fill=red] at ($ (scale) - (0, 0.28) $) {};
            \node[circle, minimum size=0.18cm, inner sep=0pt, draw=black, fill=red] at ($ (scale) + (0, 0.14) $) {};
            \node[circle, minimum size=0.18cm, inner sep=0pt, draw=black, fill=white] at ($ (scale) + (0, 0.3) $) {};
            \node[circle, minimum size=0.18cm, inner sep=0pt, draw=black, fill=red] at ($ (scale) + (0, 0.7) $) {};
            \node[circle, minimum size=0.18cm, inner sep=0pt, draw=black, fill=red] at ($ (scale) + (0, 0.95) $) {};
            \node[circle, minimum size=0.18cm, inner sep=0pt, draw=black, fill=red] at ($ (scale) + (0, 1.35) $) {};

            \node[circle, minimum size=0.18cm, inner sep=0pt, draw=black, fill=red, label=right:\footnotesize{Cases}] at ($ (scale) - (0.6, 1.7) $) {};
            \node[circle, minimum size=0.18cm, inner sep=0pt, draw=black, fill=white, label=right:\footnotesize{Controls}] at ($ (scale) - (0.6, 1.95) $) {};
        }
        \visible<16>{
            \node[draw=red, thick, densely dotted, minimum height=1.5cm, minimum width=4.02cm, label=below:\textbf{\footnotesize{\textcolor{red}{Feature spaces}}}] at ($ (secondfeatures) - (0.07, 0) $) {};
        }
        \visible<20>{
            \draw[-stealth, line width=4pt] ($ (firstfeatures.north west) - (-0.1, -0.3) $) -- ($ (thirdfeatures.north east) - (0.1, -0.3) $);
        }
        \visible<21>{
            \draw[-stealth, very thick] ($ (thirdfeatures) + (-0.4, -0.3) $) -- ($ (thirdfeatures) + (0.4, 0.3) $) node[midway, above, font=\scriptsize\bfseries, rotate=37, yshift=-0.1cm] {MMSE};
        }
    \end{tikzpicture}
\end{frame}
