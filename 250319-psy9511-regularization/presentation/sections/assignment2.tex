
\section{Assignment 2}

\begin{frame}{Assignment 2}
    \only<1>{
        {\small
            \begin{enumerate}
                \item Download the Auto.csv dataset from the ISLP website.
                \item Read the Auto.csv-dataset into memory.
                \item In the horsepower-column, some values are missing. These are encoded with ‘?’. Remove these rows from the dataset.
                \item Create a new column ‘muscle’. This column should contain a 1 for all muscle cars (e.g. cars that have above average horsepower) and 0 for the rest.
                \item Split the dataset into a training set and a test set, by randomly drawing 80\% of the rows for the former and 20\% of the rows for the latter.
            \end{enumerate}
            \vspace{0.25cm}
        }
        \centering
        \scriptsize\url{http://localhost:8890/notebooks/notebooks/Assignment\%202.ipynb}
    }
    \only<2>{
        {\small
            \begin{enumerate}
                \item Fit a simple linear regression model using horsepower as the predictor and mpg as the outcome using the training data.
                \item Create a scatter plot with horsepower on the x-axis and mpg on the y-axis using the testing data. Plot the regression line found by the model in the plot.
                \item Use the model to generate predictions for the training set. Calculate and report the mean absolute error (MAE) of these predictions.
                \item Use the model to generate predictions for the test set. Calculate and report the MAE of the predictions.
            \end{enumerate}
            \vspace{0.25cm}
        }
        \centering
        \scriptsize\url{http://localhost:8890/notebooks/notebooks/Assignment\%202.ipynb}
    }
    \only<3>{
        {\small
            Reflection: Is the training or testing MAE is lower? Does this match your expectation? What would be the general pattern we expect here (e.g. one is lower than the other, they are the same, etc.), and why do we expect that?
        }
    }
    \only<4>{
        {\small
            \begin{enumerate}
                \item Fit a multivariate linear regression model using horsepower, weight, displacement, and year as predictors and mpg as the outcome.
                \item Print the intercept and coefficients of the model .
                \item Use the model to generate predictions for the training set. Calculate and report the MAE of these predictions.
                \item Use the model to generate predictions for the test set. Calculate and report the MAE of the predictions.
            \end{enumerate}
            \vspace{0.25cm}
        }
        \centering
        \scriptsize\url{http://localhost:8890/notebooks/notebooks/Assignment\%202.ipynb}
    }
    \only<5>{
        {\small
            Is the training MAE lower or higher than in the simple linear regression model? Does it have to be this way, or could it have been otherwise? What about the testing MAE?
        }
    }
    \only<6>{
        {\small
            \begin{enumerate}
                \item Fit a logistic regression model using weight, displacement and year as predictors and our newly created muscle-column as the outcome.
                \item Use the model to generate predictions for the training set. Calculate and report the accuracy of these predictions.
                \item Use the model to generate predictions for the testing set. Calculate and report the accuracy of these predictions.
            \end{enumerate}
            \vspace{0.25cm}
        }
        \centering
        \scriptsize\url{http://localhost:8890/notebooks/notebooks/Assignment\%202.ipynb}
    }
\end{frame}

\newcommand{\datasetnode}[4]{
    \node[
        minimum width=0.4cm,
        minimum height=1cm,
        draw=black,
        inner sep=0pt,
        outer sep=0pt,
        fill=#3,
        anchor=#4
    ] (#1) at #2 {};
}

\begin{frame}{Assignment 2: Random seeds}

    \begin{tikzpicture}
        \node[] at (-5.25, -3.5) {};
        \node[] at (5.25, 3.5) {};

        \only<1-3>{
            \PythonInputNode{1}{(-4, 3)}{pythonnode}{0.9\textwidth}{7}{
                import pandas as pd^^J
                ^^J
                ^^J
                df = pd.DataFrame(...)^^J
                train = df.sample(frac=0.8)^^J
                test = df.drop(train.index)^^J
            }
        }
        \only<4>{
            \PythonInputNode{1}{(-4, 3)}{pythonnode}{0.9\textwidth}{7}{
                import pandas as pd^^J
                import numpy as np^^J
                np.random.seed(42)^^J
                df = pd.DataFrame(...)^^J
                train = df.sample(frac=0.8)^^J
                test = df.drop(train.index)^^J
            }
        }

        \datasetnode{n00}{(-3.43, 0)}{gray!20}{center}
        \datasetnode{n01}{(n00.east)}{gray!20}{west}
        \datasetnode{n02}{(n01.east)}{gray!20}{west}
        \datasetnode{n03}{(n02.east)}{gray!20}{west}
        \datasetnode{n04}{(n03.east)}{gray!20}{west}
        \datasetnode{n05}{(n04.east)}{gray!20}{west}
        \datasetnode{n06}{(n05.east)}{gray!20}{west}
        \datasetnode{n07}{(n06.east)}{gray!20}{west}
        \datasetnode{n08}{(n07.east)}{gray!20}{west}
        \datasetnode{n09}{(n08.east)}{gray!20}{west}
        \datasetnode{n10}{(n09.east)}{gray!20}{west}
        \datasetnode{n11}{(n10.east)}{gray!20}{west}
        \datasetnode{n12}{(n11.east)}{gray!20}{west}
        \datasetnode{n13}{(n12.east)}{gray!20}{west}
        \datasetnode{n14}{(n13.east)}{gray!20}{west}
        \datasetnode{n15}{(n14.east)}{gray!20}{west}
        \datasetnode{n16}{(n15.east)}{gray!20}{west}
        \datasetnode{n17}{(n16.east)}{gray!20}{west}
        \datasetnode{n18}{(n17.east)}{gray!20}{west}
        \datasetnode{n19}{(n18.east)}{gray!20}{west}

        \only<1-2,4>{
            \datasetnode{t03}{($ (n03.south) - (0, 0.5) $)}{blue!60}{north}
            \datasetnode{t11}{($ (n11.south) - (0, 0.5) $)}{blue!60}{north}
            \datasetnode{t14}{($ (n14.south) - (0, 0.5) $)}{blue!60}{north}
            \datasetnode{t16}{($ (n16.south) - (0, 0.5) $)}{blue!60}{north}
            \datasetnode{t05}{($ (n05.south) - (0, 0.5) $)}{blue!60}{north}
            \datasetnode{t12}{($ (n12.south) - (0, 0.5) $)}{blue!60}{north}
            \datasetnode{t10}{($ (n10.south) - (0, 0.5) $)}{blue!60}{north}
            \datasetnode{t18}{($ (n18.south) - (0, 0.5) $)}{blue!60}{north}
            \datasetnode{t00}{($ (n00.south) - (0, 0.5) $)}{blue!60}{north}
            \datasetnode{t17}{($ (n17.south) - (0, 0.5) $)}{blue!60}{north}
            \datasetnode{t09}{($ (n09.south) - (0, 0.5) $)}{blue!60}{north}
            \datasetnode{t19}{($ (n19.south) - (0, 0.5) $)}{blue!60}{north}
            \datasetnode{t15}{($ (n15.south) - (0, 0.5) $)}{blue!60}{north}
            \datasetnode{t06}{($ (n06.south) - (0, 0.5) $)}{blue!60}{north}
            \datasetnode{t13}{($ (n13.south) - (0, 0.5) $)}{blue!60}{north}
            \datasetnode{t04}{($ (n04.south) - (0, 0.5) $)}{blue!60}{north}

            \datasetnode{v01}{($ (t00.south) - (-0.4, 0.5) $)}{red!60}{north}
            \datasetnode{v02}{($ (t03.south) - (0.4, 0.5) $)}{red!60}{north}
            \datasetnode{v07}{($ (t06.south) - (-0.4, 0.5) $)}{red!60}{north}
            \datasetnode{v08}{($ (t09.south) - (0.4, 0.5) $)}{red!60}{north}
        }

        \only<2,4>{
            \node[] (outcome) at ($ (v08.east) + (3, 0) $) {MAE=3.5};
            \draw[-stealth] ($ (v08.east) + (1, 0) $) -- (outcome);
        }
        \only<3>{
            \datasetnode{t14}{($ (n14.south) - (0, 0.5) $)}{blue!60}{north}
            \datasetnode{t16}{($ (n16.south) - (0, 0.5) $)}{blue!60}{north}
            \datasetnode{t05}{($ (n05.south) - (0, 0.5) $)}{blue!60}{north}
            \datasetnode{t12}{($ (n12.south) - (0, 0.5) $)}{blue!60}{north}
            \datasetnode{t10}{($ (n10.south) - (0, 0.5) $)}{blue!60}{north}
            \datasetnode{t18}{($ (n18.south) - (0, 0.5) $)}{blue!60}{north}
            \datasetnode{t17}{($ (n17.south) - (0, 0.5) $)}{blue!60}{north}
            \datasetnode{t09}{($ (n09.south) - (0, 0.5) $)}{blue!60}{north}
            \datasetnode{t19}{($ (n19.south) - (0, 0.5) $)}{blue!60}{north}
            \datasetnode{t15}{($ (n15.south) - (0, 0.5) $)}{blue!60}{north}
            \datasetnode{t06}{($ (n06.south) - (0, 0.5) $)}{blue!60}{north}
            \datasetnode{t13}{($ (n13.south) - (0, 0.5) $)}{blue!60}{north}
            \datasetnode{t01}{($ (n01.south) - (0, 0.5) $)}{blue!60}{north}
            \datasetnode{t02}{($ (n02.south) - (0, 0.5) $)}{blue!60}{north}
            \datasetnode{t07}{($ (n07.south) - (0, 0.5) $)}{blue!60}{north}
            \datasetnode{t08}{($ (n08.south) - (0, 0.5) $)}{blue!60}{north}

            \datasetnode{v00}{($ (t01.south) - (0.4, 0.5) $)}{red!60}{north}
            \datasetnode{v03}{($ (t02.south) - (-0.4, 0.5) $)}{red!60}{north}
            \datasetnode{v04}{($ (t05.south) - (0.4, 0.5) $)}{red!60}{north}
            \datasetnode{v11}{($ (t12.south) - (0.4, 0.5) $)}{red!60}{north}

            \node[] (outcome) at ($ (v08.east) + (3, 0) $) {MAE=9.2};
            \draw[-stealth] ($ (v08.east) + (1.5, 0) $) -- (outcome);
        }
    \end{tikzpicture}
\end{frame}

\begin{frame}{Assignment 2: Log-odds vs probability vs class}
    \begin{tikzpicture}
        \node[] at (-5.25, -3) {};
        \node[] at (5.25, 3) {};

        \only<1-3>{
            \RInputNode{(-5, 2)}{in1}{0.95\textwidth}{7}{
                model <- glm(muscle ~ year + weight, data=df, family='binomial')^^J
                predict(model, df)
            }
        }
        \only<2-3>{
            \RInputNode{(-5, 1)}{in1}{0.95\textwidth}{7}{
                { }{ }{ }{ }{ }1{ }{ }{ }{ }{ }{ }2{ }{ }{ }{ }{ }{ }3{ }{ }{ }{ }{ }{ }4{ }{ }{ }{ }{ }{ }5{ }{ }{ }{ }{ }{ }6{ }{ }{ }{ }{ }{ }7{ }{ }{ }{ }{ }{ }8{ }{ }{ }{ }{ }{ }9{ }{ }{ }{ }{ }10{ }{ }{ }{ }{ }11^^J
                1.2460 1.9245 1.0019 0.9911 1.0485 4.2506 4.1465 4.5522 2.4889 1.4578 1.6223^^J
            }
        }
        \only<3>{
            \RInputNode{(-5, -0.3)}{in1}{0.95\textwidth}{7}{
                predict(model, df, type="response")^^J
            }
            \RInputNode{(-5, -1)}{in1}{0.95\textwidth}{7}{
                { }{ }{ }{ }{ }1{ }{ }{ }{ }{ }{ }2{ }{ }{ }{ }{ }{ }3{ }{ }{ }{ }{ }{ }4{ }{ }{ }{ }{ }{ }5{ }{ }{ }{ }{ }{ }6{ }{ }{ }{ }{ }{ }7{ }{ }{ }{ }{ }{ }8{ }{ }{ }{ }{ }{ }9{ }{ }{ }{ }{ }10{ }{ }{ }{ }{ }11^^J
                0.7766 0.8726 0.7314 0.7293 0.7405 0.9853 0.9844 0.9895 0.9233 0.8112 0.8352^^J
            }
        }
        \only<4>{
            \PythonInputNode{1}{(-4, 3)}{pythonnode}{0.9\textwidth}{7}{
                model = LogisticRegression()^^J
                model.fit(df[['year', 'weight']], df['muscle'])^^J
                model.predict(df[['year', 'weight']])^^J
            }
            \PythonOutputNode{1}{(-3.89, 2)}{pythonnode}{0.791\textwidth}{7}{
                array([0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0])^^J
            }

            \PythonInputNode{1}{(-4, 0.5)}{pythonnode}{0.9\textwidth}{7}{
                model.predict_proba(df[['year', 'weight']])^^J
            }

            \PythonOutputNode{1}{(-3.89, 0.07)}{pythonnode}{0.791\textwidth}{7}{
                array([[0.14, 0.86], [0.08, 0.92], [0.17, 0.83], [0.18, 0.82]])^^J
            }
        }
    \end{tikzpicture}
\end{frame}

\begin{frame}{Assignment 2: Eye test}
    \begin{tikzpicture}
        \node[] at (-5.25, -3) {};
        \node[] at (5.25, 3) {};

        \only<1-2>{
            \RInputNode{(-5, 2.5)}{in1}{0.95\textwidth}{7}{
                model <- glm(muscle ~ year + weight, data=df, family='binomial')^^J
                predict(model, df)
            }
            \RInputNode{(-5, 1.5)}{in1}{0.95\textwidth}{7}{
                { }{ }{ }{ }{ }1{ }{ }{ }{ }{ }{ }2{ }{ }{ }{ }{ }{ }3{ }{ }{ }{ }{ }{ }4{ }{ }{ }{ }{ }{ }5{ }{ }{ }{ }{ }{ }6{ }{ }{ }{ }{ }{ }7{ }{ }{ }{ }{ }{ }8{ }{ }{ }{ }{ }{ }9{ }{ }{ }{ }{ }10{ }{ }{ }{ }{ }11^^J
                1.2460 1.9245 1.0019 0.9911 1.0485 4.2506 4.1465 4.5522 2.4889 1.4578 1.6223^^J
            }
        }

        \only<2>{
            \RInputNode{(-5, 0)}{in1}{0.95\textwidth}{7}{
                model <- lm(mpg ~ horsepower, df)^^J
                summary(model)^^J
            }
            \RInputNode{(-5, -1)}{in1}{0.95\textwidth}{7}{
                Coefficients:^^J
                Estimate Std. Error t value Pr(>|t|) ^^J
                (Intercept)    19.59412    0.96187  20.371  < 2e-16 ***^^J
                horsepower102   0.40588    4.08087   0.099 0.920840    ^^J
                horsepower103   0.70588    4.08087   0.173 0.862789    ^^J
                horsepower105   0.90588    1.49529   0.606 0.545091  ^^J
            }
        }

    \end{tikzpicture}
\end{frame}

\begin{frame}{Assignment 2: Interpretation}
    \centering
    \begin{tikzpicture}
        \begin{axis}[
            xmajorgrids=true,
            ymajorgrids=true,
            tick style={draw=none},
            xlabel={year},
            ylabel={mpg},
            xmin=69.1,
            xmax=82.9,
        ]
            \addplot[
                only marks,
                mark=*,
                color=blue,
                opacity=0.25,
                mark size=3pt
            ] table[
                col sep=comma,
                y=mpg,
                x=year
            ] {data/Auto.csv};
            \only<2-3>{
                \addplot[
                    very thick,
                    blue,
                    domain=69:83,
                ] {-47+0.95*x};
            }
            \only<3>{
                \addplot[
                    very thick,
                    red,
                    domain=69:83,
                ] {-28+0.7*x};
            }
        \end{axis}
    \end{tikzpicture}
\end{frame}
